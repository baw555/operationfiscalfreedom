ğŸ§© STEP-BY-STEP: How to do this safely
STEP 1 â€” Create a thin shell (10 minutes)

Create a new file (do not modify logic yet):

client/src/pages/affiliate-nda/AffiliateNdaPage.tsx


Move only routing + auth gating here (which you already fixed):

export function AffiliateNdaPage() {
  return (
    <NdaShell />
  )
}


No hooks. No queries. No camera.

STEP 2 â€” Build the shell that always renders
function NdaShell() {
  return (
    <div className="nda-layout">
      <h1>Affiliate NDA</h1>

      <Suspense fallback={<SectionSkeleton />}>
        <NdaStatusPanel />
      </Suspense>

      <Suspense fallback={<SectionSkeleton />}>
        <LegalTextPanel />
      </Suspense>

      <Suspense fallback={<SectionSkeleton />}>
        <SignaturePanel />
      </Suspense>

      <Suspense fallback={<SectionSkeleton />}>
        <UploadPanel />
      </Suspense>
    </div>
  )
}


ğŸš« No shared loading state
ğŸš« No â€œif (!everything) return â€¦â€

This is where concurrency is unlocked.

STEP 3 â€” Move queries into their own panels
Example: NDA status
function NdaStatusPanel() {
  const ndaStatus = useQueryNdaStatus()

  if (ndaStatus.hasSigned) {
    return <SignedNotice />
  }

  return <UnsignedNotice />
}


Now:

NDA status loads independently

rest of page renders instantly

STEP 4 â€” Isolate camera/signature logic (huge win)

All of this should move into SignaturePanel:

camera access

canvas

drawing

resize handling

submit

This panel is allowed to be heavy because it no longer blocks anything else.

If camera fails â†’ only signature panel errors.

STEP 5 â€” Upload panel stands alone
function UploadPanel() {
  const uploadConfig = useUploadConfig()
  return <Uploader config={uploadConfig} />
}


No coupling to NDA status or camera.

ğŸš¦ IMPORTANT RULES (do not break)

âŒ No page-level isLoading

âŒ No â€œwait for everythingâ€

âŒ No shared query results

âŒ No prop-drilling async data

Every panel owns its own fate.

ğŸ§ª HOW YOU KNOW IT WORKED (immediately)

After Step 2â€“3:

Refresh on slow network

You should see:

Page frame instantly

Legal text quickly

Signature panel load later

Upload panel later

No spinner covering the whole page

No white screens

That â€œfeels fastâ€ sensation = success.

â›” STOP CONDITION (very important)

Do not decompose the entire 1,094 lines at once.

Do this in two passes:

Structural split (files + Suspense)

Internal cleanup (later, optional)

Youâ€™re aiming for parallelism first, cleanliness second.