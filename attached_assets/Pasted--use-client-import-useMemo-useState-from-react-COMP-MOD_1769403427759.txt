"use client";
import { useMemo, useState } from "react";

/**
 * COMP MODEL (per your newest instruction):
 * - Gross Revenue = 100%
 * - Rep ecosystem separate: 22.5% house comp pool (outside this page) + 2.5% recruiter bounty
 * - House Allocation Pool = 75% of Gross, broken into 6 levels:
 *    L1 (Top Rep) = 67% of Gross (on their produced business)
 *    Remaining 8% of Gross allocated across Levels 2–6 (5 levels), weighted toward closest rep:
 *      L2 = 3.5%
 *      L3 = 2.0%
 *      L4 = 1.2%
 *      L5 = 0.8%
 *      L6 = 0.5%  (Company base)
 *    Total = 67% + 8% = 75%
 * - Compression: inactive L2–L5 collapse upward into L6 (Company). No sideways redistribution.
 */

export default function CompPlan() {
  const [grossRevenue, setGrossRevenue] = useState<number>(100000);

  // Recruiter bounty (separate from the 75% pool)
  const [recruiterExists, setRecruiterExists] = useState<boolean>(true);

  // Activity flags for Levels 2–5 (compression if inactive)
  const [l2Active, setL2Active] = useState<boolean>(true);
  const [l3Active, setL3Active] = useState<boolean>(true);
  const [l4Active, setL4Active] = useState<boolean>(true);
  const [l5Active, setL5Active] = useState<boolean>(true);

  const pct = {
    recruiter: 0.025, // 2.5% bounty (separate)
    l1: 0.67,        // Top rep gets 67% of gross on their produced business
    l2: 0.035,
    l3: 0.020,
    l4: 0.012,
    l5: 0.008,
    l6: 0.005,       // Company base; also receives all compression from L2–L5
  };

  const results = useMemo(() => {
    const gross = Math.max(0, Number.isFinite(grossRevenue) ? grossRevenue : 0);

    // Recruiter
    const recruiterPay = recruiterExists ? gross * pct.recruiter : 0;

    // House 75% total (sanity)
    const housePool = gross * 0.75;

    // L1 always paid
    const l1Pay = gross * pct.l1;

    // Base shares for L2–L6
    const l2Base = gross * pct.l2;
    const l3Base = gross * pct.l3;
    const l4Base = gross * pct.l4;
    const l5Base = gross * pct.l5;
    const l6Base = gross * pct.l6;

    // Apply activity + compression to L6
    const l2Pay = l2Active ? l2Base : 0;
    const l3Pay = l3Active ? l3Base : 0;
    const l4Pay = l4Active ? l4Base : 0;
    const l5Pay = l5Active ? l5Base : 0;

    const compressedToL6 =
      (l2Active ? 0 : l2Base) +
      (l3Active ? 0 : l3Base) +
      (l4Active ? 0 : l4Base) +
      (l5Active ? 0 : l5Base);

    const l6Pay = l6Base + compressedToL6;

    const houseAllocated = l1Pay + l2Pay + l3Pay + l4Pay + l5Pay + l6Pay; // should equal 75% of gross
    const totalPaid = recruiterPay + houseAllocated;

    return {
      gross,
      recruiterPay,
      housePool,
      l1Pay,
      l2Pay,
      l3Pay,
      l4Pay,
      l5Pay,
      l6Pay,
      houseAllocated,
      totalPaid,
    };
  }, [grossRevenue, recruiterExists, l2Active, l3Active, l4Active, l5Active]);

  const money = (n: number) =>
    n.toLocaleString(undefined, { style: "currency", currency: "USD", maximumFractionDigits: 2 });

  return (
    <div className="max-w-5xl mx-auto p-8 space-y-10">
      <h1 className="text-3xl font-bold">Comp Plan & Calculator</h1>

      {/* ===== COMP PLAN LANGUAGE ===== */}
      <section className="space-y-4">
        <h2 className="text-xl font-semibold">Compensation Plan Language (Ready to Use)</h2>

        <p className="max-w-4xl">
          <strong>Gross Revenue</strong> means revenue actually received by the Company from a customer transaction, net of refunds,
          chargebacks, taxes collected on behalf of governmental authorities, and payment processing fees.
        </p>

        <p className="max-w-4xl">
          <strong>Recruiter / Sponsor Bounty (Separate).</strong> A separate <strong>2.5%</strong> recruiter bounty may be paid to the
          individual who directly introduces a producing representative into the network. This bounty is outside of, and does not reduce,
          the House Allocation Pool.
        </p>

        <p className="max-w-4xl">
          <strong>House Allocation Pool.</strong> The Company retains and conditionally allocates <strong>75%</strong> of Gross Revenue
          (the “House Allocation Pool”) across six levels as follows, subject to performance eligibility and compression:
        </p>

        <ul className="list-disc ml-6">
          <li><strong>Level 1 (Top Producer):</strong> 67% of Gross Revenue on business directly produced by Level 1</li>
          <li><strong>Level 2 (Closest Upline):</strong> 3.5% of Gross Revenue (conditional)</li>
          <li><strong>Level 3:</strong> 2.0% of Gross Revenue (conditional)</li>
          <li><strong>Level 4:</strong> 1.2% of Gross Revenue (conditional)</li>
          <li><strong>Level 5:</strong> 0.8% of Gross Revenue (conditional)</li>
          <li><strong>Level 6 (Company Retained Allocation):</strong> 0.5% of Gross Revenue + all compressed amounts</li>
        </ul>

        <p className="max-w-4xl">
          <strong>Compression & Reversion.</strong> Levels 2–5 are not automatic. If any Level 2–5 participant is inactive, non-compliant,
          or fails to meet performance thresholds established by the Company, that level’s allocation automatically <strong>compresses upward
          and reverts to Level 6 (Company)</strong>. No sideways redistribution occurs.
        </p>

        <p className="max-w-4xl">
          <strong>Non-Vested / Modifiable.</strong> All allocations are non-vested, non-guaranteed, and subject to modification, suspension,
          or termination by the Company prospectively with notice.
        </p>
      </section>

      {/* ===== CALCULATOR ===== */}
      <section className="space-y-6 border-t pt-6">
        <h2 className="text-xl font-semibold">Live Calculator</h2>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <label className="space-y-2">
            <div className="font-medium">Gross Revenue</div>
            <input
              type="number"
              value={grossRevenue}
              onChange={(e) => setGrossRevenue(Number(e.target.value))}
              className="border p-2 w-full rounded"
              min={0}
              step={100}
            />
          </label>

          <label className="flex items-center gap-2 mt-7">
            <input
              type="checkbox"
              checked={recruiterExists}
              onChange={() => setRecruiterExists(!recruiterExists)}
            />
            Recruiter Exists (2.5% bounty)
          </label>

          <label className="flex items-center gap-2">
            <input type="checkbox" checked={l2Active} onChange={() => setL2Active(!l2Active)} />
            Level 2 Active (3.5%)
          </label>

          <label className="flex items-center gap-2">
            <input type="checkbox" checked={l3Active} onChange={() => setL3Active(!l3Active)} />
            Level 3 Active (2.0%)
          </label>

          <label className="flex items-center gap-2">
            <input type="checkbox" checked={l4Active} onChange={() => setL4Active(!l4Active)} />
            Level 4 Active (1.2%)
          </label>

          <label className="flex items-center gap-2">
            <input type="checkbox" checked={l5Active} onChange={() => setL5Active(!l5Active)} />
            Level 5 Active (0.8%)
          </label>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div className="border rounded p-4">
            <div className="text-sm text-gray-600">House Allocation Pool (75%)</div>
            <div className="text-xl font-bold">{money(results.housePool)}</div>
          </div>
          <div className="border rounded p-4">
            <div className="text-sm text-gray-600">Top Rep (67% of Gross)</div>
            <div className="text-xl font-bold">{money(results.l1Pay)}</div>
          </div>
          <div className="border rounded p-4">
            <div className="text-sm text-gray-600">House Allocated (should = 75% of Gross)</div>
            <div className="text-xl font-bold">{money(results.houseAllocated)}</div>
          </div>
        </div>

        <table className="w-full border rounded overflow-hidden">
          <thead>
            <tr className="border-b font-semibold bg-gray-50">
              <td className="p-2">Bucket / Level</td>
              <td className="p-2">Payout</td>
              <td className="p-2">Notes</td>
            </tr>
          </thead>
          <tbody>
            <tr className="border-b">
              <td className="p-2">Recruiter Bounty (2.5% of Gross)</td>
              <td className="p-2">{money(results.recruiterPay)}</td>
              <td className="p-2">{recruiterExists ? "On" : "Off"}</td>
            </tr>

            <tr className="border-b font-semibold">
              <td className="p-2">Level 1 — Top Producer (67%)</td>
              <td className="p-2">{money(results.l1Pay)}</td>
              <td className="p-2">Direct produced business</td>
            </tr>

            <tr className="border-b">
              <td className="p-2">Level 2 (3.5%)</td>
              <td className="p-2">{money(results.l2Pay)}</td>
              <td className="p-2">{l2Active ? "Active" : "Inactive → compresses to L6"}</td>
            </tr>
            <tr className="border-b">
              <td className="p-2">Level 3 (2.0%)</td>
              <td className="p-2">{money(results.l3Pay)}</td>
              <td className="p-2">{l3Active ? "Active" : "Inactive → compresses to L6"}</td>
            </tr>
            <tr className="border-b">
              <td className="p-2">Level 4 (1.2%)</td>
              <td className="p-2">{money(results.l4Pay)}</td>
              <td className="p-2">{l4Active ? "Active" : "Inactive → compresses to L6"}</td>
            </tr>
            <tr className="border-b">
              <td className="p-2">Level 5 (0.8%)</td>
              <td className="p-2">{money(results.l5Pay)}</td>
              <td className="p-2">{l5Active ? "Active" : "Inactive → compresses to L6"}</td>
            </tr>

            <tr className="font-bold bg-gray-50">
              <td className="p-2">Level 6 — Company (0.5% + compression)</td>
              <td className="p-2">{money(results.l6Pay)}</td>
              <td className="p-2">Receives base + all inactive shares</td>
            </tr>

            <tr>
              <td className="p-2 font-semibold">Total Paid (Recruiter + House Pool Allocations)</td>
              <td className="p-2 font-semibold">{money(results.totalPaid)}</td>
              <td className="p-2">Includes recruiter bounty + 75% allocations</td>
            </tr>
          </tbody>
        </table>
      </section>
    </div>
  );
}
