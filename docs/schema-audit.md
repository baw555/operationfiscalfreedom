# Relational Database Truth Audit

**Generated:** 2026-02-08 (auto-generated by `scripts/audit-schema.ts`)  
**Source:** `shared/schema.ts`, `shared/models/auth.ts`  
**ORM:** Drizzle ORM (PostgreSQL)

> Run `npx tsx scripts/audit-schema.ts` to regenerate this report.

---

## Summary Statistics

| Metric | Count |
|---|---|
| **Total tables** | 95 |
| **Tables with declared FKs** | 58 |
| **Tables with no FKs at all** | 37 |
| **Total declared FK constraints** | 83 |
| **Missing FK constraints** | 47 |
| **Polymorphic join patterns** | 4 |
| **Booleans stored as text** | 15 columns |
| **JSON stored in text (not JSONB)** | 21 columns |
| **Denormalized referral chain columns** | 23 |
| **Separate identity systems** | 4 |

---

## All Tables

| # | Table Name | Primary Key | PK Type | Unique Constraints | FK Count |
|---|---|---|---|---|---|
| 1 | `users` | `id` | serial | `email`, `referral_code` | 0 |
| 2 | `affiliate_applications` | `id` | serial | — | 1 |
| 3 | `help_requests` | `id` | serial | — | 2 |
| 4 | `startup_grants` | `id` | serial | — | 1 |
| 5 | `furniture_assistance` | `id` | serial | — | 1 |
| 6 | `investor_submissions` | `id` | serial | — | 1 |
| 7 | `private_doctor_requests` | `id` | serial | — | 1 |
| 8 | `website_applications` | `id` | serial | — | 1 |
| 9 | `general_contact` | `id` | serial | — | 1 |
| 10 | `vlt_affiliates` | `id` | serial | `email`, `referral_code` | 0 |
| 11 | `opportunities` | `id` | serial | — | 0 |
| 12 | `sales` | `id` | serial | — | 2 |
| 13 | `commissions` | `id` | serial | — | 2 |
| 14 | `veteran_intake` | `id` | serial | — | 0 |
| 15 | `business_intake` | `id` | serial | — | 0 |
| 16 | `vlt_intake` | `id` | serial | — | 0 |
| 17 | `contract_templates` | `id` | serial | — | 0 |
| 18 | `signed_agreements` | `id` | serial | — | 2 |
| 19 | `commission_config` | `id` | serial | — | 0 |
| 20 | `affiliate_nda` | `id` | serial | — | 1 |
| 21 | `legal_signatures` | `id` | serial | — | 1 |
| 22 | `legal_override_audit` | `id` | serial | — | 2 |
| 23 | `signature_metrics` | `id` | serial | — | 0 |
| 24 | `compliance_runs` | `id` | serial | — | 0 |
| 25 | `business_leads` | `id` | serial | — | 2 |
| 26 | `ip_referral_tracking` | `id` | serial | — | 1 |
| 27 | `affiliate_w9` | `id` | serial | — | 1 |
| 28 | `finops_referrals` | `id` | serial | — | 1 |
| 29 | `disability_referrals` | `id` | serial | — | 2 |
| 30 | `job_placement_intakes` | `id` | serial | — | 2 |
| 31 | `vet_professional_intakes` | `id` | serial | — | 2 |
| 32 | `healthcare_intakes` | `id` | serial | — | 0 |
| 33 | `schedule_a_signatures` | `id` | serial | — | 1 |
| 34 | `insurance_intakes` | `id` | serial | — | 1 |
| 35 | `medical_sales_intakes` | `id` | serial | — | 2 |
| 36 | `business_dev_intakes` | `id` | serial | — | 2 |
| 37 | `csu_contract_templates` | `id` | serial | — | 0 |
| 38 | `csu_contract_template_fields` | `id` | serial | — | 1 |
| 39 | `csu_contract_sends` | `id` | serial | `sign_token` | 2 |
| 40 | `csu_signed_agreements` | `id` | serial | — | 2 |
| 41 | `csu_envelopes` | `id` | serial | — | 2 |
| 42 | `csu_envelope_recipients` | `id` | serial | `sign_token` | 1 |
| 43 | `csu_audit_trail` | `id` | serial | — | 4 |
| 44 | `portal_activity` | `id` | serial | — | 1 |
| 45 | `affiliate_activities` | `id` | serial | `hash` | 1 |
| 46 | `notification_settings` | `id` | serial | `user_id` | 1 |
| 47 | `notification_audit` | `id` | serial | — | 0 |
| 48 | `notification_queue` | `id` | serial | — | 1 |
| 49 | `password_reset_tokens` | `id` | serial | — | 1 |
| 50 | `partner_sharing_log` | `id` | serial | — | 0 |
| 51 | `consent_records` | `id` | serial | — | 0 |
| 52 | `affiliated_partners` | `id` | serial | — | 0 |
| 53 | `ranger_tab_applications` | `id` | serial | — | 0 |
| 54 | `conversations` | `id` | serial | — | 0 |
| 55 | `messages` | `id` | serial | — | 0 |
| 56 | `hipaa_audit_log` | `id` | serial | — | 1 |
| 57 | `hipaa_training_records` | `id` | serial | — | 1 |
| 58 | `business_associate_agreements` | `id` | serial | — | 1 |
| 59 | `user_mfa_config` | `id` | serial | `user_id` | 1 |
| 60 | `auth_rate_limits` | `id` | serial | — | 0 |
| 61 | `ai_generations` | `id` | serial | — | 1 |
| 62 | `ai_templates` | `id` | serial | — | 0 |
| 63 | `operator_ai_memory` | `id` | serial | — | 1 |
| 64 | `ai_users` | `id` | serial | `email`, `anon_device_id` | 0 |
| 65 | `ai_sessions` | `id` | serial | `session_token` | 1 |
| 66 | `ai_messages` | `id` | serial | — | 1 |
| 67 | `ai_files` | `id` | serial | — | 2 |
| 68 | `ai_memory` | `id` | serial | — | 2 |
| 69 | `ai_jobs` | `id` | serial | — | 2 |
| 70 | `media_pipelines` | `id` | serial | — | 2 |
| 71 | `pipeline_steps` | `id` | serial | — | 1 |
| 72 | `pipeline_artifacts` | `id` | serial | — | 2 |
| 73 | `claim_sessions` | `id` | serial | — | 1 |
| 74 | `claim_answers` | `id` | serial | — | 1 |
| 75 | `claim_tasks` | `id` | serial | — | 2 |
| 76 | `claim_files` | `id` | serial | — | 3 |
| 77 | `evidence_requirements` | `id` | serial | — | 0 |
| 78 | `claim_cases` | `id` | serial | — | 0 |
| 79 | `case_shares` | `id` | serial | — | 1 |
| 80 | `case_notes` | `id` | serial | — | 1 |
| 81 | `case_deadlines` | `id` | serial | — | 1 |
| 82 | `vendor_magic_links` | `id` | serial | `token` | 0 |
| 83 | `vendor_sessions` | `id` | serial | `session_token` | 0 |
| 84 | `repair_logs` | `id` | serial | — | 0 |
| 85 | `critical_incidents` | `id` | serial | `incident_id` | 0 |
| 86 | `incident_audit_log` | `id` | serial | — | 0 |
| 87 | `sailor_conversations` | `id` | serial | — | 0 |
| 88 | `sailor_messages` | `id` | serial | — | 1 |
| 89 | `sailor_faq` | `id` | serial | — | 0 |
| 90 | `events` | `id` | serial | — | 0 |
| 91 | `idempotency_keys` | `key` | text | — | 0 |
| 92 | `session` | `sid` | varchar | — | 0 |
| 93 | `identity_map` | `id` | serial | — | 0 |
| 94 | `sessions` | `sid` | varchar | — | 0 |
| 95 | `veteran_auth_users` | `id` | varchar | `email` | 0 |

---

## All Declared Foreign Keys

| Source Table | Source Column | Target Table | Target Column |
|---|---|---|---|
| `affiliate_applications` | `assigned_to` | `users` | `id` |
| `help_requests` | `assigned_to` | `users` | `id` |
| `help_requests` | `referred_by` | `users` | `id` |
| `startup_grants` | `assigned_to` | `users` | `id` |
| `furniture_assistance` | `assigned_to` | `users` | `id` |
| `investor_submissions` | `assigned_to` | `users` | `id` |
| `private_doctor_requests` | `assigned_to` | `users` | `id` |
| `website_applications` | `assigned_to` | `users` | `id` |
| `general_contact` | `assigned_to` | `users` | `id` |
| `sales` | `opportunity_id` | `opportunities` | `id` |
| `sales` | `affiliate_id` | `vltAffiliates` | `id` |
| `commissions` | `sale_id` | `sales` | `id` |
| `commissions` | `affiliate_id` | `vltAffiliates` | `id` |
| `signed_agreements` | `contract_template_id` | `contractTemplates` | `id` |
| `signed_agreements` | `user_id` | `users` | `id` |
| `affiliate_nda` | `user_id` | `users` | `id` |
| `legal_signatures` | `user_id` | `users` | `id` |
| `legal_override_audit` | `admin_id` | `users` | `id` |
| `legal_override_audit` | `user_id` | `users` | `id` |
| `business_leads` | `assigned_to` | `users` | `id` |
| `business_leads` | `referred_by` | `users` | `id` |
| `ip_referral_tracking` | `affiliate_id` | `users` | `id` |
| `affiliate_w9` | `user_id` | `users` | `id` |
| `finops_referrals` | `affiliate_id` | `users` | `id` |
| `disability_referrals` | `affiliate_id` | `users` | `id` |
| `disability_referrals` | `assigned_to` | `users` | `id` |
| `job_placement_intakes` | `affiliate_id` | `users` | `id` |
| `job_placement_intakes` | `assigned_to` | `users` | `id` |
| `vet_professional_intakes` | `affiliate_id` | `users` | `id` |
| `vet_professional_intakes` | `assigned_to` | `users` | `id` |
| `schedule_a_signatures` | `user_id` | `users` | `id` |
| `insurance_intakes` | `referred_by` | `users` | `id` |
| `medical_sales_intakes` | `referred_by` | `users` | `id` |
| `medical_sales_intakes` | `assigned_to` | `users` | `id` |
| `business_dev_intakes` | `referred_by` | `users` | `id` |
| `business_dev_intakes` | `assigned_to` | `users` | `id` |
| `csu_contract_template_fields` | `template_id` | `csuContractTemplates` | `id` |
| `csu_contract_sends` | `template_id` | `csuContractTemplates` | `id` |
| `csu_contract_sends` | `sent_by` | `users` | `id` |
| `csu_signed_agreements` | `contract_send_id` | `csuContractSends` | `id` |
| `csu_signed_agreements` | `template_id` | `csuContractTemplates` | `id` |
| `csu_envelopes` | `template_id` | `csuContractTemplates` | `id` |
| `csu_envelopes` | `sent_by` | `users` | `id` |
| `csu_envelope_recipients` | `envelope_id` | `csuEnvelopes` | `id` |
| `csu_audit_trail` | `envelope_id` | `csuEnvelopes` | `id` |
| `csu_audit_trail` | `recipient_id` | `csuEnvelopeRecipients` | `id` |
| `csu_audit_trail` | `contract_send_id` | `csuContractSends` | `id` |
| `csu_audit_trail` | `actor_user_id` | `users` | `id` |
| `portal_activity` | `user_id` | `users` | `id` |
| `affiliate_activities` | `actor_user_id` | `users` | `id` |
| `notification_settings` | `user_id` | `users` | `id` |
| `notification_queue` | `user_id` | `users` | `id` |
| `password_reset_tokens` | `user_id` | `users` | `id` |
| `hipaa_audit_log` | `user_id` | `users` | `id` |
| `hipaa_training_records` | `user_id` | `users` | `id` |
| `business_associate_agreements` | `last_reviewed_by` | `users` | `id` |
| `user_mfa_config` | `user_id` | `users` | `id` |
| `ai_generations` | `user_id` | `users` | `id` |
| `operator_ai_memory` | `user_id` | `users` | `id` |
| `ai_sessions` | `user_id` | `aiUsers` | `id` |
| `ai_messages` | `session_id` | `aiSessions` | `id` |
| `ai_files` | `owner_user_id` | `aiUsers` | `id` |
| `ai_files` | `session_id` | `aiSessions` | `id` |
| `ai_memory` | `user_id` | `aiUsers` | `id` |
| `ai_memory` | `source_message_id` | `aiMessages` | `id` |
| `ai_jobs` | `user_id` | `aiUsers` | `id` |
| `ai_jobs` | `session_id` | `aiSessions` | `id` |
| `media_pipelines` | `user_id` | `aiUsers` | `id` |
| `media_pipelines` | `session_id` | `aiSessions` | `id` |
| `pipeline_steps` | `pipeline_id` | `mediaPipelines` | `id` |
| `pipeline_artifacts` | `pipeline_id` | `mediaPipelines` | `id` |
| `pipeline_artifacts` | `step_id` | `pipelineSteps` | `id` |
| `claim_sessions` | `veteran_user_id` | `veteranAuthUsers` | `id` |
| `claim_answers` | `session_id` | `claimSessions` | `id` |
| `claim_tasks` | `session_id` | `claimSessions` | `id` |
| `claim_tasks` | `case_id` | `claimCases` | `id` |
| `claim_files` | `session_id` | `claimSessions` | `id` |
| `claim_files` | `case_id` | `claimCases` | `id` |
| `claim_files` | `veteran_user_id` | `veteranAuthUsers` | `id` |
| `case_shares` | `case_id` | `claimCases` | `id` |
| `case_notes` | `case_id` | `claimCases` | `id` |
| `case_deadlines` | `case_id` | `claimCases` | `id` |
| `sailor_messages` | `conversation_id` | `sailorConversations` | `id` |

---

## Missing Foreign Keys (47)

| Table | Column | Should Reference | Reason |
|---|---|---|---|
| `vlt_affiliates` | `level1_id` | vlt_affiliates.id | Self-referential hierarchy level |
| `vlt_affiliates` | `level2_id` | vlt_affiliates.id | Self-referential hierarchy level |
| `vlt_affiliates` | `level3_id` | vlt_affiliates.id | Self-referential hierarchy level |
| `vlt_affiliates` | `level4_id` | vlt_affiliates.id | Self-referential hierarchy level |
| `vlt_affiliates` | `level5_id` | vlt_affiliates.id | Self-referential hierarchy level |
| `vlt_affiliates` | `level6_id` | vlt_affiliates.id | Self-referential hierarchy level |
| `vlt_affiliates` | `level7_id` | vlt_affiliates.id | Self-referential hierarchy level |
| `vlt_affiliates` | `recruiter_id` | vlt_affiliates.id | Recruiter reference without FK |
| `sales` | `referred_by_l1` | vlt_affiliates.id | Referral chain without FK |
| `sales` | `referred_by_l2` | vlt_affiliates.id | Referral chain without FK |
| `sales` | `referred_by_l3` | vlt_affiliates.id | Referral chain without FK |
| `sales` | `referred_by_l4` | vlt_affiliates.id | Referral chain without FK |
| `sales` | `referred_by_l5` | vlt_affiliates.id | Referral chain without FK |
| `sales` | `referred_by_l6` | vlt_affiliates.id | Referral chain without FK |
| `sales` | `referred_by_l7` | vlt_affiliates.id | Referral chain without FK |
| `sales` | `recruiter_id` | vlt_affiliates.id | Recruiter reference without FK |
| `veteran_intake` | `referred_by_l1` | vlt_affiliates.id | Referral chain without FK |
| `veteran_intake` | `referred_by_l2` | vlt_affiliates.id | Referral chain without FK |
| `veteran_intake` | `referred_by_l3` | vlt_affiliates.id | Referral chain without FK |
| `veteran_intake` | `referred_by_l4` | vlt_affiliates.id | Referral chain without FK |
| `veteran_intake` | `referred_by_l5` | vlt_affiliates.id | Referral chain without FK |
| `veteran_intake` | `referred_by_l6` | vlt_affiliates.id | Referral chain without FK |
| `veteran_intake` | `referred_by_l7` | vlt_affiliates.id | Referral chain without FK |
| `veteran_intake` | `assigned_to` | users.id | Assignment field without FK |
| `business_intake` | `referred_by_l1` | vlt_affiliates.id | Referral chain without FK |
| `business_intake` | `referred_by_l2` | vlt_affiliates.id | Referral chain without FK |
| `business_intake` | `referred_by_l3` | vlt_affiliates.id | Referral chain without FK |
| `business_intake` | `referred_by_l4` | vlt_affiliates.id | Referral chain without FK |
| `business_intake` | `referred_by_l5` | vlt_affiliates.id | Referral chain without FK |
| `business_intake` | `referred_by_l6` | vlt_affiliates.id | Referral chain without FK |
| `business_intake` | `referred_by_l7` | vlt_affiliates.id | Referral chain without FK |
| `business_intake` | `assigned_to` | users.id | Assignment field without FK |
| `vlt_intake` | `assigned_to` | users.id | Assignment field without FK |
| `vlt_intake` | `referred_by_l1` | vlt_affiliates.id | Referral chain without FK |
| `vlt_intake` | `referred_by_l2` | vlt_affiliates.id | Referral chain without FK |
| `vlt_intake` | `referred_by_l3` | vlt_affiliates.id | Referral chain without FK |
| `vlt_intake` | `referred_by_l4` | vlt_affiliates.id | Referral chain without FK |
| `vlt_intake` | `referred_by_l5` | vlt_affiliates.id | Referral chain without FK |
| `vlt_intake` | `referred_by_l6` | vlt_affiliates.id | Referral chain without FK |
| `signed_agreements` | `affiliate_id` | users.id OR vlt_affiliates.id (polymorphic) | Polymorphic affiliate reference |
| `signature_metrics` | `user_id` | user table (type mismatch: text vs integer) | User ID stored as text |
| `ai_generations` | `template_id` | related template table | Template reference without FK |
| `claim_tasks` | `veteran_user_id` | veteran_auth_users.id | Veteran user reference without FK |
| `claim_cases` | `veteran_user_id` | veteran_auth_users.id | Veteran user reference without FK |
| `critical_incidents` | `incident_id` | critical_incidents | Incident reference without FK |
| `incident_audit_log` | `incident_id` | critical_incidents | Incident reference without FK |
| `incident_audit_log` | `admin_id` | users.id | Admin reference without FK |

---

## Polymorphic Join Patterns

| Table | Columns | Description |
|---|---|---|
| `signed_agreements` | `affiliate_id` | Polymorphic — can reference users.id OR vlt_affiliates.id |
| `partner_sharing_log` | `submission_id`, `submission_type` | Polymorphic submission reference |
| `consent_records` | `submission_id`, `submission_type` | Polymorphic submission reference |
| `events` | `entity_id`, `entity_type` | Polymorphic reference to any table |

---

## Booleans Stored as Text

| Table | Column |
|---|---|
| `vlt_affiliates` | `is_comp_active` |
| `opportunities` | `is_active` |
| `sales` | `l2_active` |
| `sales` | `l3_active` |
| `sales` | `l4_active` |
| `sales` | `l5_active` |
| `business_intake` | `is_veteran_owned` |
| `vlt_intake` | `is_veteran` |
| `contract_templates` | `is_active` |
| `signed_agreements` | `agreed_to_terms` |
| `commission_config` | `is_active` |
| `affiliate_nda` | `agreed_to_terms` |
| `job_placement_intakes` | `is_veteran` |
| `vet_professional_intakes` | `is_veteran` |
| `csu_signed_agreements` | `agreed_to_terms` |

---

## JSON Stored in Text Columns (not JSONB)

| Table | Column |
|---|---|
| `job_placement_intakes` | `industries_selected` |
| `csu_contract_sends` | `field_values` |
| `csu_envelope_recipients` | `field_values` |
| `csu_audit_trail` | `metadata` |
| `portal_activity` | `metadata` |
| `affiliate_activities` | `metadata` |
| `affiliate_activities` | `notified_emails` |
| `notification_audit` | `recipients` |
| `consent_records` | `partners_shared_with` |
| `hipaa_audit_log` | `metadata` |
| `user_mfa_config` | `backup_codes` |
| `ai_generations` | `beat_map` |
| `ai_generations` | `metadata` |
| `ai_messages` | `attachments` |
| `ai_files` | `extracted_metadata` |
| `media_pipelines` | `execution_plan` |
| `pipeline_steps` | `input_params` |
| `pipeline_steps` | `output_data` |
| `pipeline_steps` | `depends_on` |
| `pipeline_steps` | `artifact_urls` |
| `pipeline_artifacts` | `metadata` |

---

## Denormalized Referral Chain Columns

| Table | Column |
|---|---|
| `vlt_affiliates` | `level1_id` |
| `vlt_affiliates` | `level2_id` |
| `vlt_affiliates` | `level3_id` |
| `vlt_affiliates` | `level4_id` |
| `vlt_affiliates` | `level5_id` |
| `vlt_affiliates` | `level6_id` |
| `sales` | `referred_by_l1` |
| `sales` | `referred_by_l2` |
| `sales` | `referred_by_l3` |
| `sales` | `referred_by_l4` |
| `sales` | `referred_by_l5` |
| `sales` | `referred_by_l6` |
| `sales` | `referred_by_l7` |
| `veteran_intake` | `referred_by_l1` |
| `veteran_intake` | `referred_by_l2` |
| `veteran_intake` | `referred_by_l3` |
| `business_intake` | `referred_by_l1` |
| `business_intake` | `referred_by_l2` |
| `business_intake` | `referred_by_l3` |
| `vlt_intake` | `referred_by_l1` |
| `vlt_intake` | `referred_by_l2` |
| `vlt_intake` | `referred_by_l3` |
| `vlt_intake` | `referred_by_l4` |

---

## Identity Systems (No Cross-References)

| Identity Table | PK Type | Referenced By |
|---|---|---|
| `users` | serial | `affiliate_applications`, `help_requests`, `help_requests`, `startup_grants`, `furniture_assistance`, `investor_submissions`, `private_doctor_requests`, `website_applications`, `general_contact`, `signed_agreements`, `affiliate_nda`, `legal_signatures`, `legal_override_audit`, `legal_override_audit`, `business_leads`, `business_leads`, `ip_referral_tracking`, `affiliate_w9`, `finops_referrals`, `disability_referrals`, `disability_referrals`, `job_placement_intakes`, `job_placement_intakes`, `vet_professional_intakes`, `vet_professional_intakes`, `schedule_a_signatures`, `insurance_intakes`, `medical_sales_intakes`, `medical_sales_intakes`, `business_dev_intakes`, `business_dev_intakes`, `csu_contract_sends`, `csu_envelopes`, `csu_audit_trail`, `portal_activity`, `affiliate_activities`, `notification_settings`, `notification_queue`, `password_reset_tokens`, `hipaa_audit_log`, `hipaa_training_records`, `business_associate_agreements`, `user_mfa_config`, `ai_generations`, `operator_ai_memory` |
| `vlt_affiliates` | serial | `sales`, `commissions` |
| `veteran_auth_users` | varchar | `claim_sessions`, `claim_files` |
| `ai_users` | serial | `ai_sessions`, `ai_files`, `ai_memory`, `ai_jobs`, `media_pipelines` |

---

*No fixes proposed. Report complete. All findings are structural observations of current schema definition.*
